# 视频播放器应用测试环境使用指南

## 测试环境概述

我们为视频播放器应用提供了完整的测试环境，支持以下测试方式：

1. **Docker容器化测试**（推荐）：在隔离环境中运行所有测试，避免环境依赖问题
2. **本地Vitest测试**：使用Vitest框架运行前端测试，更现代且性能更好
3. **Jest备选测试**：保留了Jest测试配置作为备选方案
4. **后端独立测试**：支持Java和Python后端代码的独立测试
5. **CI/CD自动化测试**：通过GitHub Actions自动运行所有测试

## 如何运行测试

### Docker容器化测试（推荐方式）

使用Docker可以确保在一致的环境中运行测试，避免"在我机器上能运行"的问题。

```powershell
# 运行所有测试
.\run_all_docker_tests.ps1
```

### Vitest前端测试

Vitest是一个专为Vite设计的现代测试框架，比Jest更快、更轻量。

```powershell
# 安装Vitest依赖
.\install_vitest_deps.ps1

# 运行所有前端测试
npm test

# 监视模式运行（开发中使用）
npm run test:watch

# 生成测试覆盖率报告
npm run test:coverage

# UI界面运行测试
npm run test:ui
```

### Jest备选测试

如果因为某些原因Vitest不适合您的项目，我们仍然保留了Jest测试配置。

```powershell
# 运行Jest测试
npm run test:jest-legacy
```

### 后端测试

```powershell
# Python后端测试
cd python
python -m pytest

# Java后端测试
cd backend
mvn test
```

## 测试文件位置

- **前端组件测试**：`__tests__/components/`
- **前端服务测试**：`__tests__/services/`
- **Python测试**：`python/tests/`
- **Java测试**：`backend/src/test/`

## 常见问题解决

### 前端测试问题

1. **依赖错误**：
   ```powershell
   # 重新安装依赖
   .\install_vitest_deps.ps1
   ```

2. **TypeScript类型错误**：
   ```powershell
   # 检查类型定义
   npx tsc --noEmit
   ```

3. **DOM相关错误**：
   确保`vitest.setup.fix.ts`文件中包含了所有需要的DOM模拟

### Docker测试问题

1. **Docker未运行**：确保Docker Desktop已启动
2. **端口冲突**：检查端口是否被占用，可修改`docker-compose.test.yml`中的端口映射
3. **卷挂载问题**：确保Docker有权限访问项目目录

## 添加新测试

### 组件测试

```tsx
// __tests__/components/YourComponent.test.tsx
import { render, screen } from '@testing-library/react';
import YourComponent from '@/components/path/YourComponent';

describe('YourComponent', () => {
  test('应该正确渲染', () => {
    render(<YourComponent />);
    // 添加断言
    expect(screen.getByText('预期文本')).toBeInTheDocument();
  });
});
```

### 服务测试

```tsx
// __tests__/services/yourService.test.ts
import { describe, test, expect, vi } from 'vitest';
import { yourFunction } from '@/services/yourService';

describe('yourService', () => {
  test('yourFunction应该正确工作', async () => {
    // 测试实现
    const result = await yourFunction();
    expect(result).toBe(预期结果);
  });
});
```

## 测试环境维护

1. 定期更新依赖以解决安全问题和兼容性问题
2. 在添加新功能时同时添加对应的测试
3. 使用`test:coverage`命令检查测试覆盖率，努力保持高覆盖率
4. 参考`test_summary.md`文档了解更多测试环境信息
